name: test

on: [push]

jobs:
  test:
    runs-on: ubuntu-22.04

    steps:
      - uses: actions/checkout@v4
        # with:
        #   submodules: recursive
      - name: yq # needed for the mason registry to work locally (https://github.com/williamboman/mason.nvim/pull/1457)
        uses: mikefarah/yq@master
      - name: neovim
        uses: rhysd/action-setup-vim@v1
        with:
          # apt neovim is too old
          neovim: true
          version: nightly # using vim.fs.joinpath
      - name: deps - node.js # various dependencies
        uses: actions/setup-node@v4
        with:
          node-version: 20.x
      - name: debug
        run: HOME=./home nvim --headless -c "echo &rtp" +qa
      - name: debug 2
        run: HOME=./home nvim --headless -c "echo &rtp" +qa
      - name: build
        run: |
          unset XDG_CONFIG_HOME
          make
